set -gx EDITOR hx
set fish_greeting ""

set -gx PATH $PATH $HOME/.krew/bin

alias vogit="cd ~/go/src/github.com/voigt/"
alias dotfiles="cd ~/go/src/github.com/voigt/dotfiles/"
alias cd="z"
alias reloadhx="pkill -USR1 hx"
alias gt='gardenctl target'
alias gtd='gardenctl target --garden dev'
alias gtt='gardenctl target --garden tst'
alias gtp='gardenctl target --garden prd'
alias gtp2='gardenctl target --garden eu02-prod'
alias gctlp='eval $(gardenctl provider-env fish)'

source $HOME/.config/fish/functions/zoxide.fish

switch (uname)
    case Linux
			alias hx="helix"
            if status is-interactive
                # evaluate whether this works better than the auto-start
                # script below
                # eval zellij attach --create main
                eval (zellij setup --generate-auto-start fish | string collect)
                source (starship init fish --print-full-init | psub)
            end
    case Darwin
            fish_add_path /opt/homebrew/opt/make/libexec/gnubin
            fish_add_path ~/go/src/github.com/openbao/devbao/bin
            fish_add_path ~/go/src/github.com/Ki-Reply-GmbH/openbao/hack
            fish_add_path ~/go/src/github.com/Ki-Reply-GmbH/openbao/bin
            fish_add_path ~/go/bin/
            fish_add_path ~/.local/bin
            fish_add_path ~/.cargo/bin
            fish_add_path /usr/local/bin
            fish_add_path ~/.zvm/self
            fish_add_path ~/.zvm/bin
            fish_add_path /opt/homebrew/opt/llvm/bin
            fish_add_path ~/git/dotfiles/bin/tmp
            fish_add_path ~/go/bin/

            if status is-interactive
                # fish history
                atuin init fish --disable-up-arrow | source

                # Commands to run in interactive sessions can go here
                eval "$(/opt/homebrew/bin/brew shellenv)"

                fish_add_path ~/go/bin/
                # evaluate whether this works better than the auto-start
                # script below
                # eval zellij attach --create main
                eval (zellij setup --generate-auto-start fish | string collect)
                source (starship init fish --print-full-init | psub)
                source (kubectl completion fish | psub)
            end

            
            # Added by OrbStack: command-line tools and integration
            # This won't be added again if you remove it.
            source ~/.orbstack/shell/init2.fish 2>/dev/null || :

    case '*'
            echo "OS not detected. Please check fishrc"
end

# Helpers for note taking
set NOTES "$HOME/notebook/07_Inbox"
alias onote="hx $NOTES"

function templatenow
    set template $NOTES/../03_Resources/Templates/Blog\ Now.md
    echo "$(
    cat $template | sed 's/<% tp.file.creation_date("YYYY-MM-DD") %>/'$(date '+%Y-%m-%d')'/' | sed 's/<% tp.file.last_modified_date("YYYY-MM-DD") %>/'$(date '+%Y-%m-%d')'/'
    )"
end

function note
    set directory $NOTES
    set name $(date '+%Y-%m-%d_%H-%M-%S')
    set suffix ".md"

    if test $argv[1]
        # if test $argv[1] = now
        #     echo $argv[1]

        #     set directory $NOTES/../09_Blog/now/
        #     set filename "$name$suffix"

        #     # this does not work as expected
        #     templatenow | hx # "$directory/$filename"
        #     echo "$NOTES/$filename"

        #     return 0
        # end

        set name $argv[1]
        if test $argv[1] = open
            echo $argv[1]
            set name ""
            set suffix ""
        end
    end

    set filename "$name$suffix"

    hx "$NOTES/$filename"
    echo "$NOTES/$filename"
end

zoxide init fish | source
set GOPRIVATE 'github.com/stackitcloud,dev.azure.com/*'

gardenctl rc fish | source
fish_add_path ~/go/bin/
